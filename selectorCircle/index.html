<!DOCTYPE html>
<html>
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
	<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">

	<title></title>

	<link rel="stylesheet" type="text/css" href="http://yui.yahooapis.com/2.8.2r1/build/reset/reset-min.css">
	
	<style>
		h1{
			font-size:24px;
			margin:15px 0;
		}
		
		#main_container{
			padding:15px;
			background-color:#eee;
		}
		
		#circle_container{
			border:solid 1px #ddd;
			height:600px;
			width:900px;
			background-color:#fff;
			position:relative;
			overflow:auto;
		}
		
		.circle-selector {
			width:15px;
			height:15px;
			border:solid 3px #0063DC;
			background-color:rgba(68, 68, 68, .5);
			moz-border-radius:50%;
			webkit-border-radius:50%;
			border-radius:50%;
		}
		
		.resizable {
			cursor:nw-resize;
		}
		
		.draggable {
			cursor:move;
		}
	</style>
</head>
<body>
	<div id="main_container">
		<header>
			<h1>Resizable and draggable circle</h1>
		</header>
		<div id="content_container">
			<div id="circle_container">
				
			</div>
		</div>
		<footer></footer>
	</div>

	<script type="text/javascript" charset="utf-8"
	        src="http://yui.yahooapis.com/3.3.0/build/yui/yui-min.js">
	</script>
	
	<script>
		YUI().use("base","node", function(Y) {

			function SelectorCircle(config) {

				SelectorCircle.superclass.constructor.apply(this, arguments);

			}

			/*
			*  Privates
			*/
			function dragDirection(xy) {
				var width  = this.circle_node.get('offsetWidth'),
				    height = this.circle_node.get('offsetHeight');
				
				console.log(width,height,this.getDistanceFromCentroid(xy));
				return this.circle_node;
			}

			SelectorCircle.NAME = "SelectorCircle";

			SelectorCircle.ATTRS = {
				root_node : {
					value : null
				},
				initial_radius : {
					value : 15
				},
				initial_xy : {
					value : null
				},
				resizable : {
					value : true
				},
				draggable : {
					value : true
				},
				default_class : {
					value : 'circle-selector'
				},
				draggable_class : {
					value : 'draggable'
				},
				resizable_class : {
					value : 'resizable'
				},
				dragging_class : {
					value : 'dragging'
				},
				resizing_class : {
					value : 'resizing'
				},
				border_width: {
					value : 3
				}
			}

			/*
			*  Publics
			*/
			Y.extend(SelectorCircle, Y.Base, {
				circle_node : null,
				create : function() {
					var root_node     = this.get('root_node'),
					    default_class = this.get('default_class');
					
					root_node.append('<div class="' + default_class + '"></div>');
					
					var circle_node = root_node.one('.' + default_class),
					    that        = this;
					
					if(circle_node) {
						circle_node.setStyle('height',this.get('initial_radius')*2);
						circle_node.setStyle('width',this.get('initial_radius')*2);
						circle_node.setStyle('border-width',this.get('border_width') + 'px');
						
						if(Y.Lang.isObject(this.get('initial_xy'))) {
							circle_node.setXY(this.get('initial_xy'));
						}

						root_node.on('mousemove',function(e) {
							var distance = that.getDistanceFromCentroid(that.offsetParentXY([e.pageX,e.pageY]));
							
							if(distance < 17) {
								e.target.addClass(that.get('draggable_class'));
								e.target.removeClass(that.get('resizable_class'));
							} else if(distance < 20) {
								e.target.addClass(that.get('resizable_class'));
								e.target.removeClass(that.get('draggable_class'));
							}
							
							if(that.circle_node.hasClass(that.get('resizing_class'))) {
								that.circle_node.setStyle('width',(distance*2) + 'px');
								that.circle_node.setStyle('height',(distance*2) + 'px');
							}
						});
						
						root_node.on('mousedown',function(e) {
							console.log(dragDirection.apply(that,[that.offsetParentXY([e.pageX,e.pageY])]));
							if(e.target.hasClass(that.get('resizable_class'))) {
								that.circle_node.addClass(that.get('resizing_class'));
							}
						});
						
						root_node.on('mouseup',function(e) {
							console.log(dragDirection.apply(that,[that.offsetParentXY([e.pageX,e.pageY])]));
							that.circle_node.removeClass(that.get('resizing_class'));
						});
						
						circle_node.on('mouseout',function(e) {
							var distance = that.getDistanceFromCentroid(that.offsetParentXY([e.pageX,e.pageY]));
							
							e.target.removeClass(that.get('resizable_class'));
							e.target.removeClass(that.get('draggable_class'));
						});
					}
					
					this.circle_node = circle_node;
				},
				show : function() {
					var root_node     = this.get('root_node'),
					    default_class = this.get('default_class');
					
					if(root_node) {
						var circle_node = root_node.one('.' + default_class);

						if(circle_node) {
							circle_node.setStyle('display','block');
						} else {
							this.create();
						}
					} else {
						Y.log('No root node was found in the module configuration','error','selector-circle');
					}
				},
				getCentroid : function() {
					var root_node        = this.get('root_node'),
					    circle_node      = this.circle_node,
					    parent_offset_xy = this.offsetParentXY(circle_node.getXY()),
					    half_node_width  = circle_node.get('offsetWidth')/2;
					
					return [(parent_offset_xy[0]+half_node_width),(parent_offset_xy[1]+half_node_width)];
				},
				getDistanceFromCentroid : function(xy) {
					
					var centroid_xy = this.getCentroid();

					return Math.sqrt(Math.pow(centroid_xy[0]-xy[0], 2.0) + Math.pow(centroid_xy[1]-xy[1], 2.0));
				},
				offsetParentXY : function(xy) {
					var root_node = this.get('root_node');
					return [xy[0]-root_node.getX(),xy[1]-root_node.getY()];
				}
			});

			var selector_circle = new SelectorCircle({
				root_node : Y.one('#circle_container')
			});
			
			selector_circle.show();
			console.log(selector_circle.getCentroid());
		});
	</script>
</body>
</html>